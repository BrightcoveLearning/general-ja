---
title: 'JavaScript モジュールのデザインパターン'
parent: Developers
---
<article class="bcls-article">
  <h1>コンセプト：JavaScript モジュールのデザインパターン</h1>
  <summary>このトピックでは、JavaScript モジュールデザインパターンを使用して、コードが Web ページ上の他のスクリプトと競合する可能性を減らす方法を学習します。</summary>
  <section class="bcls-section">
    <h2 id="Scope_conflicts">スコープの競合</h2>
    <p>JavaScript では、<code translate="No">var</code>要素を使用して変数を定義すると、その変数が定義されている関数内でスコープが設定されます。を使用せずに変数を定義すると<code translate="No">var</code>、グローバルスコープが割り当てられます。つまり、グローバル変数はページ上の他のスクリプトとの衝突に対して脆弱です。</p>
    <p>コード例を見てみましょう。次のコードでは、関数と変数はページのスコープ内に存在します。</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">// script 1
var incrementCount = function() {
    count++;
}

var myButton = document.getElementById('buttonId');
var count = 0;

myButton.onclick = incrementCount;</code></pre>
    <p>ここで、スクリプトの外部に、<code translate="No">count</code>グローバル変数も変更する関数があるとします。このスクリプトの衝突は、予期しない結果を引き起こす可能性があります。</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">// script 2
var countVideos = function(videoList) {
    count = videoList.length;
}</code></pre>
    <p>結果:</p>
    <ol>
      <li><code translate="No">myButton</code>ユーザーがボタンを 2 回選択して、<code translate="No">count</code>変数をインクリメントします。<code translate="No">script 1</code>。
        <ul>
          <li><code translate="No">count</code> = <strong> 2</strong></li>
        </ul>
      </li>
      <li><code translate="No">countvideos</code>関数が呼び出され<code translate="No">Script 2</code>、Web ページにも存在します。に 10 <code translate="No">videoList</code>個の項目が含まれているとしましょう。これで、<code translate="No">count</code>グローバル変数の値は<strong> 10</strong>になります。
        <ul>
          <li><code translate="No">count</code> = <strong> 10</strong></li>
        </ul>
      </li>
      <li><code translate="No">myButton</code>ユーザーが次にボタンを選択すると、<code translate="No">count</code>変数は予期しない結果を返します。
        <ul>
          <li>期待: <code translate="No">count</code> = <strong> 3</strong></li>
          <li>実績: <code translate="No">count</code> = <strong> 11</strong></li>
        </ul>
      </li>
    </ol>
    <p>スクリプトの競合を回避しようとするかもしれませんが、ページに含まれているサードパーティスクリプトが同様の関数や変数名を使用しないという保証はありません。</p>
  </section>
  <section class="bcls-section">
    <h2 id="Anonymous_functions">無名関数</h2>
    <p>1つの解決策は、コードを無名関数 (クロージャとも呼ばれる) でラップし、すぐに実行することです。クロージャ内のコードは、他のスクリプトからはアクセスできません。だから、これはあなたにプライベート関数と変数を作成する方法を提供します。</p>
    <p>無名関数の構文は次のとおりです。</p>
    <ul>
      <li>3行目：関数の呼び出しを待つ代わりに、それが解析された直後に関数を実行するようにJavaScriptに指示する括弧の追加のセットが含まれています。</li>
    </ul>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">(function () {
    // your code
}<span class="bcls-highlight">()</span>);</code></pre>
    <p>クロージャは、アプリケーションのライフタイムを通じてプライバシーと状態を提供するため、強力です。クロージャ内のコードの場合、すべての変数と関数はクロージャスコープにのみ含まれます。しかし、クロージャ内のコードはまだグローバル変数や関数にアクセスできます。</p>
  </section>
  <section class="bcls-section">
    <h2 id="Globals">グローバル</h2>
    <p>JavaScript には暗黙グローバルと呼ばれる機能がありますが、どの変数がグローバルであるかを判断することは容易ではないため、コードの管理が難しくなる可能性があります。変数がグローバルかどうかを判断するには、インタプリタはスコープチェーンを後方に歩き、<code translate="No">var</code>名前に一致するステートメントを探す必要があります。何も見つからない場合、変数はグローバルであるとみなされます。</p>
    <h3>グローバルに渡す</h3>
    <p>無名関数を使用すると、グローバルパラメータを明示的に渡すことができます。これは、コードへのパラメータのインポートと呼ばれます。</p>
    <p>ここに例があります：</p>
    <ul>
      <li>1 行目:関数に渡されるパラメータの名前を定義します。3 行目の名前と一致する必要がないことに注意してください。ここで、<code translate="No">window</code>オブジェクトはという名前のパラメータに渡されます<code translate="No">window1</code>。</li>
      <li>3 行目: <code translate="No">window</code>オブジェクトを関数に渡します。</li>
    </ul>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">(function( window1, undefined ) {
    ...
})(window);</code></pre>
    <p>渡されるオブジェクトは 1 つしかありませんが、パラメータが 2 つあるため、<code translate="No">undefined</code>の値は未定義になります。</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">typeof undefined == "undefined"</code></pre>
    <p>これは、他の変数が定義されているかどうかを確認する簡単な方法が必要な場合に便利です。</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">if(variable1 === undefined)</code></pre>
    <h3>グローバルをエクスポートする</h3>
    <p>また、無名関数の外部で変数や関数を渡すこともできます。これは、<code translate="No">return</code>値を使用して行うことができます。</p>
    <p>ここに例があります：</p>
    <ul>
      <li>行 1: 無名関数をに割り当てます<code translate="No">BCLS</code>。この値には任意の値を指定できます。この例では、BCLS（ブライトコーブラーニングサービス）を使用しています。</li>
    </ul>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">var BCLS = (function( window1, undefined ) {
    var object1 = {};
    object1.count = 1;
    object1.method = function () {
        ...
    }
    <span class="bcls-highlight">return object1;</span>
})(window);</code></pre>
    <p><code translate="No">object1</code>オブジェクトは、2 つのパブリックプロパティ、<code translate="No">count</code>という名前の変数とという名前の関数でグローバルに利用可能になりました。<code translate="No">method</code>。彼らは私たちの無名関数の外部で次のようにアクセスすることができます：</p>
    <ul>
      <li><code translate="No">BCLS.object1.count</code></li>
      <li><code translate="No">BCLS.object1.method</code></li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="Complete_example">完全な例</h2>
    <p>ここでは、JavaScript モジュールデザインパターンの完全な例をいくつか挙げます。</p>
    <h3>例1</h3>
    <p>この例では、モジュールパターンを使用してプライベート変数とパブリック変数と関数を作成する方法を示します。</p>
    <ul>
      <li>プライベート変数: <code translate="No">myvar</code> , <code translate="No">myvar2</code></li>
      <li>プライベート機能: <code translate="No">fname</code> , <code translate="No">fname2</code></li>
      <li>パブリック変数: <code translate="No">myvar3</code></li>
      <li>パブリック関数: <code translate="No">fname3</code></li>
    </ul>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">var BCLS = ( function() {
   var myvar = value,
       myvar2 = value;

   fname = function() {
        ...
   };
   fname2 = function() {
        ...
   };

   return {
        fname3 : function() {
             ...
        },
        myvar3 = value;
   };
}());</code></pre>
    <h3>例2</h3>
    <p>この例では、グローバルオブジェクトを渡し、パブリック関数を公開します。</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">var BCLS = (function( window, document, videojs ) {
    var myvar = value;

    // use a global object passed into the anonymous function
    videojs.registerPlugin('overlay');

    fname = function() {
        ...
    }
    return {
      fname2 : function() {
            ...
        }
    }
})(window, document, videojs);

// call the public function fname2
var newvar = BCLS.fname2();</code></pre>
  </section>
  <section class="bcls-section">
    <h2 id="Code_samples">コードサンプル</h2>
    <p>一部のコード例では、JavaScript モジュールデザインパターンを使用し、このパターンの実装方法に関するアイデアを確認することができます。</p>
    <ul>
      <li><a href="https://player.support.brightcove.com/code-samples/brightcove-player-sample-floating-player.html">フローティングプレイヤー</a></li>
    </ul>
  </section>
</article>