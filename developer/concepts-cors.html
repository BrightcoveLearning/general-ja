---
title: 'CORSを理解する'
description: 'このトピックでは、ビデオ、画像、スクリプトなどのアセットのクロスオリジン参照に関して、Webに組み込まれているCORSと制約について学習します。'
parent: Developers
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Overview">概要</h2>
    <p>クロスオリジンリソース共有 (CORS) は、Web ページが、ページが配信されたドメイン以外のドメインにリクエストを送信できるようにするメカニズムです。通常、クロスドメイン要求は、ウェブブラウザによって禁止されます。CORS は、クロスオリジン要求を許可するかどうかを決定するために、ドメインが対話する方法を定義します。</p>
    <aside class="bcls-aside bcls-aside--information">CORS は、Flash アプリケーションのクロスドメイン要求をイネーブルにするメカニズムである crossdomain.xml によって、<strong></strong>または関連していないことに注意してください。</aside>
  </section>
  <section class="bcls-section">
    <h2 id="corsandbc">CORS とBrightcove</h2>
    <p>ブライトコーブのサービス/製品で CORS を使用する必要がある場合には、次の 3 つのインスタンスがあります。</p>
    <ol>
      <li><strong>動画のキャプション</strong> :動画のキャプションを含むファイルは、BrightCove 以外のドメインに保存できます。動画自体は Brightcove ドメインから配信されるため、クロスドメインの問題が発生します。</li>
      <li><strong>ブライトコーブのプレイヤーとHLS</strong> :<span class="video-cloud-only" translate="No">ブライトコーブプレーヤーの</span> HLS プラグインは、AJAX リクエストを使用して HLS ビデオのマニフェストと個々のセグメントを取得します。これらの HLS リソースはインターネットにアクセスできる任意のドメインに保存できるため、これらのリソースは、Player に提供した Brightcove ドメインとは異なるサーバー（通常は CDN ドメイン）から提供される可能性があります。これにより、再びクロスドメインの問題が発生します。</li>
      <li><strong>動画の静止画とサムネイル画像</strong>：Studio <a href="https://studio.support.brightcove.com/media/capturing-poster-and-thumbnail-images.html">でビデオの静止画とサムネイル画像をキャプチャするには</a>、ビデオレンディションに CORS ヘッダー（ほとんどのブライトコーブで有効にする必要があります）ハウスCDN（デフォルト）。カスタムCDNがある場合、またはまだ更新していないCDNがある場合、画像キャプチャは機能しません</li>
    </ol>
  </section>
  <section class="bcls-section">
    <h2 id="solution">ソリューション</h2>
    <p>Brightcove が現時点で使用しているソリューションには、CDN <code translate="No">Access-Control-Allow-Origin</code>オリジンサーバーの設定ファイルにヘッダーを設定することが含まれます。重要なのは、CDN パートナーによって異なるサーバーソリューションを使用してコンテンツを配信するため、以下のヘッダー情報はドロップインコードスニペットとしてではなく、例として提供されます。</p>
    <p>ブライトコーブは、社内 CDN サーバのプロパティに関する次のヘッダーディレクティブで成功しました。</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;FilesMatch ".(vtt|xml)$"&gt;
              Header set Access-Control-Allow-Headers: X-Requested-With
              Header add Access-Control-Allow-Origin: http://admin.brightcove.com
          &lt;/FilesMatch&gt;</code></pre>
    <p>ディレクティブの簡単な説明を次に示します。</p>
    <ul>
      <li><code translate="No">&lt;FilesMatch ".(vtt|xml)$"&gt;</code> :この条件付きでは、vtt ファイルまたは xml <code translate="No">Access-Control-Allow-Origin</code>ファイルにのみヘッダーが設定されます。テストの結果、このヘッダーが画像やその他のHTTP配信コンテンツとともに送信されないことが確認されました。</li>
      <li><code translate="No">Header set Access-Control-Allow-Headers: X-Requested-With</code> :このヘッダーは、プレイヤーが作っているリクエストが XMLHttpRequest であるため、<code translate="No">Access-Control-Allow-Origin</code>ヘッダーが機能するために必要です。</li>
      <li><code translate="No">Header add Access-Control-Allow-Origin: http://admin.brightcove.com</code> :これは、指定されたドメインからのコンテンツを許可するためのアクセス制御ヘッダー自体です。</li>
    </ul>
    <h3>ApacheでCORSを有効にする</h3>
    <p>Apache サーバーの設定でヘッダーを設定して CORS を有効にすることができます。<code translate="No">.conf</code>次のファイルを適切なファイルに配置します。</p>
    <pre class="line-numbers">
<code class="language-bash" translate="No">Header set Access-Control-Allow-Origin "*"</code></pre>
    <p>上記の例では、アスタリスクはワイルドカードとして機能し、すべてのドメインへのアクセスを許可します。ワイルドカードは、<strong> 1</strong>つの特定のドメインで置き換えることもできます。多くの場合、アセットは複数のドメインに存在するため、一般的に Brightcove プレーヤーでは機能しません。他のソリューションを実装して、許容可能なドメインの特定のホワイトリストへのアクセスを制限できます。</p>
    <h3>BYO CDN</h3>
    <p>BYO CDN をお持ちのお客様で、クロスドメインの問題がある場合は、アカウントの CORS の設定について、CDN に問い合わせてください。推奨される設定は次のとおりです。</p>
    <ul>
      <li>アクセス制御-許可ヘッダー:X-要求付き</li>
      <li>アクセス制御許可オリジン:*</li>
      <li>ファイル形式:m3u8 m3u ts xml dfxp vtt mpd m4f mp4 jpg png</li>
    </ul>
    <h3>トークン認証の要件</h3>
    <p>トークン認証が必要な場合は、上記の解決策を変更する必要があります。トークン認証の場合、CORS セキュリティモデルでは、<code translate="No">*</code><code translate="No">Access-Control-Allow-Origin</code>レスポンスの値として文字の使用が特に許可されます。ヘッダー。さらに、<code translate="No">Access-Control-Allow-Credentials</code>レスポンスヘッダーは必須であり、true に設定する必要があります。</p>
    <p>トークン認証用の更新されたヘッダーディレクティブは次のとおりです。</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;FilesMatch ".(m3u8 | m3u | ts)$"&gt;
        # with AJAX withCredentials=true (cookies sent, SSL allowed...)
        SetEnvIfNoCase ORIGIN (.*) ORIGIN=$1
        Header set Access-Control-Allow-Origin "%{ORIGIN}e"
        Header set Access-Control-Allow-Credentials "true"
        RewriteEngine On
        RewriteCond %{REQUEST_METHOD} OPTIONS
        RewriteRule ^(.*)$ $1 [R=200,L,E=HTTP_ORIGIN:%{HTTP:ORIGIN}]
  &lt;/FilesMatch&gt;</code></pre>
    <p>以下の点は、以前のソリューションとの違いについて詳しく説明します。</p>
    <ul>
      <li>ディレクティブは、Originヘッダーの存在について着信リクエストを照会し、そのヘッダーが存在する場合 (通常はそうである)、その値を変数に設定します。<code translate="No">ORIGIN</code><code translate="No">SetEnvIfNoCase ORIGIN (.*) ORIGIN=$1</code></li>
      <li><code translate="No">Access-Control-Allow-Origin</code>レスポンスヘッダー値は、<code translate="No">ORIGIN</code>作成した変数の値に設定されます。<code translate="No">Header set Access-Control-Allow-Origin "%{ORIGIN}e"</code><aside class="bcls-aside bcls-aside--information">これが環境変数であることを示すには、が必要です。<code translate="No">e</code></aside>
      </li>
      <li><code translate="No">Access-Control-Allow-Credentials</code><code translate="No">true</code>ヘッダーは以下に設定する必要があります。<code translate="No">Header set Access-Control-Allow-Credentials "true"</code></li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="hls">HLSとCORS</h2>
    <p>一部の環境（Amazon S3 など）では、HLS の CORS 設定を指定できます。次に、HLS 再生を許可するように CORS を設定します。</p>
    <pre class="line-numbers">
<code class="language-apache" translate="No">&lt;CORSConfiguration&gt;
      &lt;CORSRule&gt;
      &lt;AllowedOrigin&gt;*&lt;/AllowedOrigin&gt;
      &lt;AllowedMethod&gt;GET&lt;/AllowedMethod&gt;
      &lt;/CORSRule&gt;
&lt;/CORSConfiguration&gt;</code></pre>
    <p>Amazon S3 固有の詳細については、「<a href="https://docs.aws.amazon.com/AmazonS3/latest/dev/cors.html#how-do-i-enable-cors">クロスオリジンリソース共有の有効化」を参照してください</a>。</p>
    <p>CORS とは接線的ですが、トークン認定 HLS コンテンツ配信が正しく機能するためには、クライアントブラウザーがすべてのセッション Cookie を受け入れる必要があります。Google Chrome や Mozilla Firefox などの一部のクライアントブラウザでは、デフォルトでセッション Cookie を受け付けますが、Internet Explorer などの他のブラウザでは、このオプションを有効にする必要があります。</p>
  </section>
</article>